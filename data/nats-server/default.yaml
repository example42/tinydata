---
nats-server::settings:
  tp_prerequisites: {}

  upstream_repo: false
  package_name: 'nats-server'
  service_name: 'nats-server'
  process_name: 'nats-server'
  process_user: 'root'
  process_group: 'root'
  config_file_path: '/etc/nats/nats-server.conf'
  pid_file_path: '/run/nats-server.pid'
  init_file_path: '/etc/sysconfig/nats-server.conf'
  log_file_path:
    - '/var/log/nats-server/nats-server.log'
  config_dir_path: '/etc/nats-server'
  log_dir_path:
    - '/var/log/nats-server'

# tp 4 settings
  install_method: 'file'
  description: 'NATS is an open-source, high-performance, cloud native messaging system.'
  docker_image: 'nats'
  docker_args: ''
  website: 'https://nats.io'
  issues: 'https://github.com/nats-io/nats-server/issues'
  git_source: 'https://github.com/nats-io/nats-server'

  configs:
    main:
      path: '/etc/nats/nats-server.conf'
    init:
      path: '/etc/sysconfig/nats-server.conf'
      format: 'inifile'
    systemd:
      path: '/etc/systemd/system/nats-server.service'
      format: 'inifile_with_stanzas'

  dirs:
    main:
      path: '/etc/nats'

  user_configs:
    main:
      path: '$HOME/.nats-server/nats-server.conf'

  user_dirs:
    main:
      path: '$HOME/.nats-server'

  ports:
    main:
      port: 4222
      protocol: tcp
    management:
      port: 8222
      protocol: tcp
    routing:
      port: 6222
      protocol: tcp

  commandsTOCONF:
    info:
      list: 'nats-server list'
    debug:
      debug: 'nats-server debug'
    test:
      status: 'nats-server status'
    version: 'nats-server --version'
    run:
      start:
        command: 'nats-server start'
        arguments:
          - 'instance':
            default: ''
            description: 'Instance to start'
        options:
          config_file:
            default: 'nats-server.conf'
            value: String
            description: 'Config file to use'
      restart:
        command: 'nats-server restart'


  build:
    prerequisites:
      tp::install:
        - golang
    execs:
      build:
        command: 'GO111MODULE=on go get github.com/nats-io/nats-server/v2'

  releases:
    base_url: 'https://github.com/nats-io/nats-server/releases/download/'
    file_format: zip
    latest_version: '2.9.11'
    prerequisites: {}
    version:
      release_url: 'https://github.com/nats-io/nats-server/releases/download/v$VERSION/nats-server-v$VERSION-$OS-$ARCH.zip'
      file_name: 'nats-server-v$VERSION-$OS-$ARCH.zip'
      extracted_dir: 'nats-server-v$VERSION-$OS-$ARCH'
      base_path: 'v$VERSION/'

  install:
    enable: true
    files:
      nats-server:
        path: '/usr/local/bin/nats-server'
        mode: '0755'
    systemd_options:
      Service:
        ExecStart: '/usr/local/bin/nats-server'
        EnvironmentFile: ~
    resources: {}
    manage_service: true
    manage_user: false

